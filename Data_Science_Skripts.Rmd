---
title: "Data Science Exam, Fahrraddiebstahl in Berlin 2023 - 2024"
output:
  html_document:
    df_print: paged
  word_document: default
  pdf_document: default
---

## Vorkonfigurationen

```{r}
# Load the necessary libraries
library(readxl)
library(plotly)
library(dplyr)
library(ggplot2)
library(sf)
library(xml2)
library(lubridate)
library(treemap)
library(knitr)
```

# Datensatz laden

Für die Datenauswertung werden zwei Datensätze geladen. Zum einen die csv mit dem Namen "Fahrraddiebstahl in Berlin 2023 - 2024.csv".

```{r}
# Load the CSV dataset with ISO-8859-1 encoding
fahrraddiebstahl_datensatz <- read.csv("20.1 Stuttgart - Fahrraddiebstahl 2023+2024 Berlin/Fahrraddiebstahl in Berlin 2023 - 2024.csv", 
                                       fileEncoding = "ISO-8859-1", 
                                       colClasses = c("LOR" = "character")) # als character, um zu vermeiden, dass die 0 verloren geht
```

Zur besseren Datenbearbeitung wird der Datensatz zudem auch in ein Dataframe geladen.

```{r}
fahrraddiebstahl_datensatz_df <- data.frame(fahrraddiebstahl_datensatz)
```

Der Dataframe beinhaltet elf verschiedene Attribute.

```{r}
str(fahrraddiebstahl_datensatz)
```

### Beschreibung der Attribute

1.  **ANGELEGT_AM**: Datum und Uhrzeit der Vorgangsanlage im Format "TT.MM.JJJJ hh:mm".

2.  **TATZEIT_ANFANG_DATUM**: Beginn des Tatzeitraums im Format "TT.MM.JJJJ".

3.  **TATZEIT_ANFANG_STUNDE**: Stunde des Beginns des Tatzeitraums im Format "hh".

4.  **TATZEIT_ENDE_DATUM**: Ende des Tatzeitraums im Format "TT.MM.JJJJ".

5.  **TATZEIT_ENDE_STUNDE**: Stunde des Endes des Tatzeitraums im Format "hh".

6.  **LOR**: Kennung des Planungsraums (8-stellig) (vvxxyyzz –\> vv=Bezirksnummer, xx=Prognosebereich, yy=Bezirksregion, zz=Planungsraum

7.  **SCHADENSHOEHE**: Wert des entwendeten Gutes in Euro (Summenangabe). Bei Kellereinbrüchen inkludiert dieser Wert alle gestohlenen Gegenstände, wie Fahrräder und andere Objekte. Keine Angabe bei reinem Sachschaden.

8.  **VERSUCH**: Gibt an, ob es sich um einen Versuch handelt (Mögliche Werte: "ja"/"nein").

9.  **ART_DES_FAHRRADS**: Typ des gestohlenen Fahrrads (z. B. Herrenrad, Damenrad). Bei mehreren Fahrrädern unterschiedlichen Typs wird der Wert "diverse Fahrräder" ausgegeben.

10. **DELIKT**: Gruppierung des Delikts (Mögliche Werte: "Fahrraddiebstahl" oder "Keller- und Bodeneinbruch").

11. **ERFASSUNGSGRUND**: Detaillierte Beschreibung des Delikts.

    -   Mögliche Werte:
        -   "Einfacher Diebstahl von Fahrrädern"
        -   "Einfacher Diebstahl aus Keller/Boden von Fahrrädern"
        -   "Sonstiger schwerer Diebstahl von Fahrrädern"
        -   "Sonstiger schwerer Diebstahl in/aus Keller/Boden von Fahrrädern".
    -   Einfache Diebstähle sind Taten gemäß §242 StGB, bei denen das Diebesgut (z. B. Fahrrad) ungesichert war.
    -   Schwere Diebstähle (gemäß §243 StGB) betreffen Fälle mit vorhandenen Schutzvorrichtungen oder gewerbsmäßigem Handeln.

### Zusätzliche Anmerkungen

Der Datensatz ermöglicht keine direkte Ermittlung der exakten Anzahl gestohlener Fahrräder. Die im Rahmen der Datenanalyse ermittelten Zahlen zu Diebstählen sind daher nicht gleichbedeutend mit der tatsächlichen Anzahl der gestohlenen Fahrräder.

Der Datensatz enthält einen Zeitraum, der den vermuteten Zeitpunkt eines Fahrraddiebstahls angibt. Dieser Zeitraum wurde so gewählt, dass er maximal 72 Stunden umfasst, wie in der Beschreibung des Datensatzes vermerkt. Dennoch kann mit dem Datensatz grobe Kenntnisse über die Dauer und bevorzugte Zeiten von Diebstählen erarbeitet werden. Diese sollten jedoch aus dem zuvor genannten Grund in der Interpretation mit Vorsicht behandelt werden.

# Anzahl der Diebstähle

Dieses Kapitel beschreibt die Anzahl der Diebstählen absolut und durchschnittlich (absolute Anzahl/Einwohnerzahl). Dabei verwendet der zweite Teil Geo-Daten (Quelle:"<https://daten.odis-berlin.de/de/dataset/lor_bezirksregionen_2021/>") und ordnet die Werte den Bezirken/Bezirksregionen über die LOR zu.

## Absolute Anzahl

Dieses Unterkapitel beschreibt die absolute Anzahl an Fahrraddiebstählen aus dem Datensatz "Fahrraddiebstahl in Berlin 2023 - 2024".

### Anzahl Vorfälle insgesamt

```{r}
anzahl_fälle <- nrow(fahrraddiebstahl_datensatz)
print(paste("Die Anzahl der Vorfälle eines Diebstahls oder eines Diebstahlsversuch beträgt:", anzahl_fälle))
```

### Verteilungs (Versuchter Raub/Erfolreicher Raub/Unbekannt)

```{r}
# Tabelle erstellen
tabelle_versuche <- table(fahrraddiebstahl_datensatz['VERSUCH'])

# Tabelle als knitr-Tabelle anzeigen
kable(tabelle_versuche, caption = "Tabelle der Versuche")
```

In den meisten Fällen der gemeldeten Fahrraddiebstähle war der Diebstahl erfolgreich, während nur in 169 Fällen der Versuch scheiterte. Der Unterschied könnte jedoch auch darin liegen, dass die betroffene Person den Diebstahlsversuch nicht bemerkt oder nicht gemeldet hat, da die Fahrräder weiterhin vorhanden waren und kein durch den Versuch verursachter Schaden festgestellt wurde.

## Anzahl der Diebstähle im Zusammenhang mit den Bezirken/Bezirksregionen

Dieses Unterkapitel verknüpft den Datensatz mit den Geo-Daten (Quelle: <https://daten.odis-berlin.de/de/dataset/lor_bezirksregionen_2021>) und der Datei "LOR-Räume mit Kontextindikatoren.xlsx". Die kombinierten Daten werden in interaktiven Karten und Balkendiagrammen visualisiert, um eine übersichtliche Darstellung auch bei großen Datensätzen zu gewährleisten. Durch hoverbare Elemente können detaillierte Informationen zu den einzelnen Werten und deren Beschreibungen abgerufen werden, ohne die Gesamtübersicht zu beeinträchtigen.

### LOR-Datensatz aufbereiten

```{r}
# Lade die Excel-Datei (ersetze "datei.xlsx" durch deinen Dateipfad)
lor_df <- read_excel("20.1 Stuttgart - Fahrraddiebstahl 2023+2024 Berlin/LOR-Räume mit Kontextindikatoren.xlsx", skip = 6) # Überspringe die ersten 6 Zeilen, da diese nicht bestandteil des Datensatzes sind

# Bereite die Spaltennamen auf
colnames(lor_df) <- c("Nummer", "Name", "Einwohner", "Jugendarbeitslosigkeit", "Altersarmut", "Kinder und Jugendliche mit Migrationshintergrund", "Einwohner mit Migrationshintergrund", "Ausländische Transferbezieher", "Einfache Wohnlage (einschl. Lärmbelastung)", "Wohndauer über 10 Jahre", "Ausländerinnen und Ausländer", "Nicht-EU-Ausländerinnen und Nicht-EU-Ausländer")

# Wähle nur die Spalten Nummer und Name aus, da nur diese benötigt werden
lor_df_verkleinert <- lor_df[, c("Nummer", "Name", "Einwohner")]

# Kombinieren der DataFrames basierend auf der LOR-Nummer
fahrraddiebstahl_und_lor_df <- merge(fahrraddiebstahl_datensatz_df, lor_df_verkleinert, 
                                      by.x = "LOR", by.y = "Nummer", 
                                      all = FALSE)

# Importiere die Berlinkarte (Geo-Daten)
berlin_map <- read_sf("https://tsb-opendata.s3.eu-central-1.amazonaws.com/lor_bezirksregionen_2021/lor_bezirksregionen_2021.geojson")

str(lor_df)
str(berlin_map)
```

Bei der Aufbereitung der Daten wurden die Namen der Spalten von Kontext-Indikatoren in verständlichere Bezeichnungen geändert.

#### Beschreibung der Attribute

lor_df:

-   **Jugendarbeitslosigkeit**: Prozentsatz der Arbeitslosen unter 25 Jahren nach SGB II im Vergleich zu allen 15- bis unter 25-Jährigen zum Stichtag 31.12.2016.

-   **Altersarmut**: Prozentsatz der Empfänger von Grundsicherung nach SGB XII über der Regelaltersgrenze im Vergleich zu allen Personen über der Regelaltersgrenze am 31.12.2016.

-   **Kinder und Jugendliche mit Migrationshintergrund**: Prozentsatz der unter 18-Jährigen mit Migrationshintergrund im Vergleich zu allen unter 18-Jährigen insgesamt am 31.12.2016.

-   **Einwohner mit Migrationshintergrund**: Prozentsatz der Einwohner mit Migrationshintergrund im Vergleich zu allen Einwohnern insgesamt am 31.12.2016.

-   **Ausländische Transferbezieher**: Prozentsatz der ausländischen Empfänger von Transferleistungen nach SGB II im Vergleich zu allen Ausländern unterhalb der Regelaltersgrenze am 31.12.2016.

-   **Einfache Wohnlage (einschl. Lärmbelastung)**: Prozentsatz der Einwohner in einfacher Wohnlage (einschließlich Lärmbelastung durch Straßenverkehr) im Vergleich zu allen Einwohnern am 31.12.2016.

-   **Wohndauer über 10 Jahre**: Prozentsatz der Einwohner, die mindestens 5 Jahre an ihrer aktuellen Adresse wohnen, im Vergleich zu allen Einwohnern im Alter von 5 Jahren und älter am 31.12.2016.

-   **Ausländerinnen und Ausländer**: Prozentsatz der Ausländer im Vergleich zu allen Einwohnern am 31.12.2016.

-   **Nicht-EU-Ausländerinnen und Nicht-EU-Ausländer**: Prozentsatz der Nicht-EU-Ausländer im Vergleich zu allen Ausländern am 31.12.2016. \### Präpariere die Karten

berlin_map

-   **BZR_ID**: Eine eindeutige ID für jedes Gebiet in Berlin (Charakterfeld).

-   **BZR_NAME**: Der Name des Bezirks oder Gebietes in Berlin (Charakterfeld).

-   **BEZ**: Die Nummer des Bezirks, der das Gebiet repräsentiert (Charakterfeld).

-   **STAND**: Das Standdatum der Daten, meist der 01.01.2021 (Charakterfeld).

-   **GROESSE_m2**: Die Fläche des Gebiets in Quadratmetern (Numerisch).

-   **geometry**: Geometrische Daten, die das Gebiet in Form von Multipolygonen darstellen (Geodaten).

### Präparation absolute Anzahl der Fahrradiebstähle

Die Kombination der Geodaten beschränkt sich auf die Ebenen „Bezirk“ und „Bezirksregion“, da die Planungsräume nicht in der Karte dargestellt sind. Die Aufgabenstellung nennt zudem nur explizit die Untersuchung nach Bezirk und Bezirksregion.

Die Verbindung zwischen den Geodaten und den anderen beiden Datensätzen erfolgt über die „BZR_ID“, die den ersten sechs Ziffern der „LOR“ entspricht. Um die Verknüpfung herzustellen, müssen in den Datensätzen die letzten beiden Ziffern der „LOR“ entfernt werden, sodass diese nur noch die Länge von sechs Ziffern hat. Anschließend werden die Nummern zusammengeführt, sofern sie durch die Operation dieselbe Nummer aufweisen.

Es gibt Bezirksregionen, die denselben Namen tragen, jedoch in unterschiedlichen Bezirken existieren. Um spätere Konflikte zu vermeiden, werden doppelte Einträge herausgefiltert. Dann wird der Name der Bezirksregion so angepasst, dass die zugehörige Bezirksnummer an den Namen angehängt wird, um eine eindeutige Zuordnung zu gewährleisten.

```{r}
# Bezirksregion

# Datensatz für Bezirksregionen präparieren
lor_anzahl_bezirksregion <- fahrraddiebstahl_datensatz %>%
  mutate(LOR = as.character(LOR),
         LOR = substr(LOR, 1, 6)) %>%  # Extrahiere die ersten 6 Zeichen der LOR
  group_by(LOR) %>%
  summarise(anzahl_bezirksregion = n(), .groups = "drop")

# Zusammenführen der Fahrraddiebstahldaten mit der Berlin-Karte
berlin_map_bezirksregion <- berlin_map %>%
  left_join(lor_anzahl_bezirksregion, by = c("BZR_ID" = "LOR"))

# Doppelte Einträge in BZR_NAME finden und deren IDs extrahieren
duplicates <- berlin_map_bezirksregion %>%
  group_by(BZR_NAME) %>%
  filter(n() > 1) %>%
  ungroup()

# Behebe doppelte Einträge in Bezirksregionen, z.B. gibt es die Heerstraße in mehreren Bezirken
duplicate_ids <- duplicates$BZR_ID

# Für jede ID der doppelten Einträge den Bezirk herausfinden und an den Namen anhängen
berlin_map_bezirksregion$BZR_NAME <- sapply(berlin_map_bezirksregion$BZR_ID, function(id) {
  if (id %in% duplicate_ids) {
    # Hole den Bezirk (BEZ) für diese ID
    bez_value <- berlin_map_bezirksregion$BEZ[berlin_map_bezirksregion$BZR_ID == id][1]
    # Den Bezirk an den BZR_NAME anhängen
    return(paste0(berlin_map_bezirksregion$BZR_NAME[berlin_map_bezirksregion$BZR_ID == id], "_", bez_value))
  } else {
    return(berlin_map_bezirksregion$BZR_NAME[berlin_map_bezirksregion$BZR_ID == id])  # Falls keine Duplikate, Name unverändert lassen
  }
})

# Bezirk

lor_anzahl_bezirk <- fahrraddiebstahl_datensatz %>%
  mutate(LOR = as.character(LOR),
         LOR = substr(LOR, 1, 2)) %>%  # Extrahiere die ersten 2 Zeichen der LOR (für Bezirke)
  group_by(LOR) %>%
  summarise(anzahl_bezirk = n(), .groups = "drop")

# Absolute Anzahl der Bezirksregionen pro Bezirk
anzahl_bezirksregionen_pro_bezirk <- berlin_map %>%
  group_by(BEZ) %>%
  summarise(anzahl_bezirksregionen = n(), .groups = "drop")

berlin_map_bezirk <- anzahl_bezirksregionen_pro_bezirk %>%
  left_join(lor_anzahl_bezirk, by = c("BEZ" = "LOR"))
```

## Visualisierungen zu den absoluten Fahrradiebstählen

Die nachfolgenden Grafiken zeigen die absoluten Anzahlen der gemeldeten Fahrraddiebstähle in Bezug auf die verschiedenen Bezirksregionen und Bezirken.

### Bezirksregion

```{r}
# Basis-Karte erstellen
p_reg <- ggplot(data = berlin_map_bezirksregion) +
  geom_sf(aes(
    fill = anzahl_bezirksregion,  # Füllung basierend auf numerischen Daten
    text = paste(
      "Bezirksregion:", BZR_NAME, "<br>",
      "Fälle:", anzahl_bezirksregion
    ) # Tooltip-Inhalt
  ), color = "black") +
  scale_fill_gradient(low = "blue", high = "red", name = "Fälle", na.value = "grey") +
  theme_minimal() +
  labs(
    title = "Absolute Anzahl an Fahrraddiebstähle in Berlin: Bezirksregion",
    subtitle = "Anzahl der Fälle pro Bezirksregion",
    caption = "Quelle: Fahrraddiebstahl-Datensatz und LOR-Daten"
  )

# Interaktive Karte mit Plotly
interactive_map_reg <- ggplotly(p_reg, tooltip = "text")

# Zeige die interaktive Karte
interactive_map_reg
```

Im Rahmen der Datenanalyse werden häufig Karten zur Visualisierung eingesetzt, da sie den Bezug zwischen den Geo-Daten und dem Datensatz anschaulich darstellen. Da Kartengrafiken die Unterschiede in den Werten meist nur durch Farbverläufe anzeigen, werden sie durch ergänzende Diagramme ergänzt, um die Daten noch präziser zu veranschaulichen.

Die Karten verdeutlichen die Wertunterschiede durch Farbtonvariationen, wobei Blau für niedrige Werte und Rot für hohe Werte steht. Dieses Farbkonzept bleibt konsistent und wird in allen folgenden Karten beibehalten, die ebenfalls diese Farbvariation nutzen.

Die Kartengrafik zeigt, dass die Anzahl der gemeldeten Fahrraddiebstähle besonders im Stadtzentrum am höchsten ist, was durch die rötliche Farbgebung in dieser Region verdeutlicht wird. Besonders auffällig sind die Bezirke "Tempelhofer Vorstadt" mit insgesamt 1470 Fällen und "Alexanderplatz" mit 1386 gemeldeten Diebstählen, die in der Grafik eine markante rote Färbung aufweisen. Im Gegensatz dazu haben die Bezirke "Schmöckwitz" mit nur 10 und "Müggelheim" mit 20 Fällen deutlich weniger Diebstähle, die durch einen tiefen Blauton hervorgehoben werden.

```{r}
# Bezirksregionen sortieren nach der Anzahl der Fahrraddiebstähle
berlin_map_bezirksregion <- berlin_map_bezirksregion %>%
  arrange(anzahl_bezirksregion)

# Reihenfolge der Bezirksregionen nach der Anzahl der Fahrraddiebstähle für ggplot anpassen
berlin_map_bezirksregion$BZR_NAME <- factor(berlin_map_bezirksregion$BZR_NAME, 
                                            levels = berlin_map_bezirksregion$BZR_NAME[order(berlin_map_bezirksregion$anzahl_bezirksregion)])

# Aufgeteilter Plot Bezirksregion
split_data_bezirksregion <- split(berlin_map_bezirksregion, cut(1:nrow(berlin_map_bezirksregion), breaks = 3, labels = FALSE))

# Bestimme den minimalen und maximalen Wert von anzahl_bezirksregion für den gesamten Datensatz
min_val <- min(berlin_map_bezirksregion$anzahl_bezirksregion, na.rm = TRUE)
max_val <- max(berlin_map_bezirksregion$anzahl_bezirksregion, na.rm = TRUE)

# Aufgeteilter Plot mit interaktiven Diagrammen
interactive_plots_bezirksregion_anzahl <- lapply(1:3, function(i) {
  ggplotly(
    ggplot(split_data_bezirksregion[[i]], aes(x = BZR_NAME, y = anzahl_bezirksregion, fill = anzahl_bezirksregion, 
                                              text = paste("Bezirksregion: ", BZR_NAME, "<br>Fälle: ", anzahl_bezirksregion))) +
      geom_bar(stat = "identity") +
      scale_fill_gradient(low = "blue", high = "red", limits = c(min_val, max_val)) +
      labs(
        title = paste("Absolute Anzahl der Fahrraddiebstähle je Bezirksregion (Teil", i, ")"),
        x = NULL,  # Entfernt die Beschriftung der x-Achse
        y = "Anzahl der Fälle"
      ) +
      theme_minimal() +
      theme(axis.text.x = element_blank(),  # Entfernt die x-Achsen-Beschriftung
            axis.ticks.x = element_blank()) # Entfernt die x-Achsen-Ticks
  )
})

# Ergebnisse anzeigen
interactive_plots_bezirksregion_anzahl[[1]]
interactive_plots_bezirksregion_anzahl[[2]]
interactive_plots_bezirksregion_anzahl[[3]]
```

Das Diagramm zeigt die gleichen Ergebnisse wie die Karte, jedoch in Form eines Balkendiagramms. Die Balken sind aufsteigend nach der Anzahl der Fälle sortiert, wodurch die Unterschiede zwischen den Regionen deutlich hervortreten. Der Farbverlauf der Karte, der die Werte von Blau (niedrig) bis Rot (hoch) darstellt, wurde auch im Balkendiagramm beibehalten.

#### Bezirk

```{r}
# Interaktive Karte nur Bezirk
p_bez <- ggplot(data = berlin_map_bezirk) +
  geom_sf(aes(
    fill = anzahl_bezirk,
    text = paste0("Bezirk: ", BEZ, "<br>Fälle: ", anzahl_bezirk)
  ), color = "black") +
  scale_fill_gradient(low = "blue", high = "red", name = "Fälle", na.value = "grey") +
  theme_minimal() +
  labs(
    title = "Absolute Anzahl an Fahrraddiebstähle in Berlin: Bezirk",
    subtitle = "Anzahl der Fälle pro Bezirk",
    caption = "Quelle: Fahrraddiebstahl-Datensatz und LOR-Daten"
  )

# Interaktive Version der Karte
interactive_map_bez <- ggplotly(p_bez)

# Zeige die interaktive Karte
interactive_map_bez
```

```{r}
# Duplikate in der BEZ-Spalte entfernen und sortieren
berlin_map_bezirk <- berlin_map_bezirk %>%
  distinct(BEZ, .keep_all = TRUE) %>%
  arrange(anzahl_bezirk)

# Konvertiere die BEZ-Spalte in einen Faktor mit der aufsteigenden Reihenfolge der anzahl_bezirk
berlin_map_bezirk$BEZ <- factor(berlin_map_bezirk$BEZ, levels = berlin_map_bezirk$BEZ)

# Erstelle das Plot mit Farbverlauf
ggplot(berlin_map_bezirk, aes(x = BEZ, y = anzahl_bezirk, fill = anzahl_bezirk)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_gradient(low = "blue", high = "red") +  # Farbverlauf
  labs(
    title = "Absolute Anzahl der Fahrraddiebstähle je Bezirk",
    x = "Bezirksregion",
    y = "Anzahl der Fälle"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Die Grafiken zeigen, dass die höchste absolute Anzahl gemeldeter Fälle im Zentrum Berlins liegt. Besonders herausstechend sind Bezirk 1 und Bezirk 2, die die meisten Fälle verzeichnen. Zu diesen Bezirken gehören auch Regionen, die in den vorherigen Ergebnissen Spitzenreiter waren, wie "Tempelhofer Vorstadt" und "Alexanderplatz". Die niedrigsten Fallzahlen finden sich hingegen in Bezirk 5 und Bezirk 10. Müggelheim, das zuvor als Region mit den wenigsten absoluten Fällen identifiziert wurde, liegt jedoch nicht in einem dieser Bezirke. Dabei ist zu beachten, dass die Bezirke unterschiedlich viele Regionen umfassen, was dazu führt, dass beispielsweise Bezirk 9 nun eine deutlich höhere absolute Fallzahl aufweist.

# Durchschnittliche Fahrraddiebstähle

Da es sich dem Kapitel zuvor lediglich um absolute Anzahlen an gemeldeten Fahrradiebstählen handelte, analysiert dieses Kapitel die durchschnittlichen Fahrraddiebstählen. Dabei berechnet sich der Durchschnitt zu einen aus der absoluten Anzahl dividiert durch die Einwohnerzahl der Region/Bezirk aus der Datei "LOR-Räume mit Kontextindikatoren.xlsx" und zu anderen aus der absoluten Anzahl in einem Bezirk, dividiert durch die Anzahl der Regionen in dem Bezirk.

### Präparation Durchschnitt der Fahrradiebstähle

```{r}
# absolute Anzahl / Einwohner

# Betriebsregion

# Präpariere den Datensatz
lor_durchschnitt_bezirksregion <- fahrraddiebstahl_und_lor_df %>%
  mutate(LOR = as.character(LOR),  # Stelle sicher, dass LOR als Zeichenkette behandelt wird
         LOR = substr(LOR, 1, 6),  # Extrahiere die ersten 6 Zeichen der LOR
         Einwohner = as.numeric(Einwohner)) %>%  # Konvertiere Einwohner in numerische Werte
  group_by(LOR) %>%  # Nach den ersten 6 Zeichen der LOR gruppieren
  summarise(anzahl_bezirksregion = n(),
            Einwohner = sum(Einwohner, na.rm = TRUE), .groups = "drop") %>%  # Berechne die Summe der Einwohner pro LOR
  mutate(durchschnitt_promille = (anzahl_bezirksregion / Einwohner) * 1000)  # Berechne Promille

# Zusammenführen der Fahrraddiebstahldaten mit der Berlin-Karte
berlin_map_durschnitt_bezirksregion <- berlin_map %>%
  left_join(lor_durchschnitt_bezirksregion, by = c("BZR_ID" = "LOR"))

# Doppelte Einträge in BZR_NAME finden und deren IDs extrahieren
duplicates <- berlin_map_durschnitt_bezirksregion %>%
  group_by(BZR_NAME) %>%
  filter(n() > 1) %>%
  ungroup()

# Behebe doppelte Einträge in Bezirksregionen, z.B. gibt es die Heerstraße in mehreren Bezirken
duplicate_ids <- duplicates$BZR_ID

# Für jede ID der doppelten Einträge den Bezirk herausfinden und an den Namen anhängen
berlin_map_durschnitt_bezirksregion$BZR_NAME <- sapply(berlin_map_durschnitt_bezirksregion$BZR_ID, function(id) {
  if (id %in% duplicate_ids) {
    # Hole den Bezirk (BEZ) für diese ID
    bez_value <- berlin_map_durschnitt_bezirksregion$BEZ[berlin_map_durschnitt_bezirksregion$BZR_ID == id][1]
    # Den Bezirk an den BZR_NAME anhängen
    return(paste0(berlin_map_durschnitt_bezirksregion$BZR_NAME[berlin_map_durschnitt_bezirksregion$BZR_ID == id], "_", bez_value))
  } else {
    return(berlin_map_durschnitt_bezirksregion$BZR_NAME[berlin_map_durschnitt_bezirksregion$BZR_ID == id])  # Falls keine Duplikate, Name unverändert lassen
  }
})

# Bezirk

# Präpariere den Datensatz
lor_durchschnitt_bezirk <- fahrraddiebstahl_und_lor_df %>%
  mutate(LOR = as.character(LOR),  # Stelle sicher, dass LOR als Zeichenkette behandelt wird
         LOR = substr(LOR, 1, 2),  # Extrahiere die ersten 2 Zeichen der LOR
         Einwohner = as.numeric(Einwohner)) %>%  # Stelle sicher, dass Einwohner numerisch ist
  group_by(LOR) %>%  # Nach den ersten 2 Zeichen der LOR gruppieren
  summarise(anzahl_bezirksregion = n(),
            Einwohner = sum(Einwohner, na.rm = TRUE), .groups = "drop") %>%  # Berechne die Summe der Einwohner pro LOR
  mutate(durchschnitt_promille = (anzahl_bezirksregion / Einwohner) * 1000)  # Berechne Promille

# Zusammenführen der Fahrraddiebstahldaten mit der Berlin-Karte
berlin_map_durchschnitt_bezirk <- berlin_map %>%
  left_join(lor_durchschnitt_bezirk, by = c("BEZ" = "LOR"))
```

### Visualisierungen zu den durchschnittlichen Fahrradiebstählen (mit Bezirksregion)

```{r}
p_bez <- ggplot(data = berlin_map_bezirk) +
  geom_sf(aes(
    fill = round(anzahl_bezirk/anzahl_bezirksregionen, 2),
    text = paste0("Bezirk: ", BEZ, "<br>Fälle: ", round(anzahl_bezirk/anzahl_bezirksregionen, 2))
  ), color = "black") +
  scale_fill_gradient(low = "blue", high = "red", name = "Fälle", na.value = "grey") +
  theme_minimal() +
  labs(
    title = "Durchschnittliche Anzahl an Fahrraddiebstähle in Berlin: Bezirk",
    subtitle = "Anzahl der Fälle pro Bezirk / Bezirksregionen",
    caption = "Quelle: Fahrraddiebstahl-Datensatz und LOR-Daten"
  )

# Interaktive Version der Karte
interactive_map_bez <- ggplotly(p_bez)

# Zeige die interaktive Karte
interactive_map_bez
```

Diese Karte zeigt das Verhältnis der absoluten Anzahl der Bezirke zur Anzahl der Regionen innerhalb jedes Bezirks. Die unterschiedlichen Farbtöne verdeutlichen, dass die Analyse aus dem vorherigen Kapitel durch die ungleiche Verteilung der Regionen pro Bezirk verfälscht wurde.

Trotz dieser Anpassung bleiben Bezirk 5 und Bezirk 10 die Bezirke mit den geringsten Vorfällen, während Bezirk 1 und Bezirk 2 die Bezirke mit den meisten Vorfällen bleiben. Besonders deutlich zeigt sich eine Veränderung bei den Bezirken 1, 6, 9 und 12.

### Visualisierungen zu den durchschnittlichen Fahrradiebstählen (mit Einwohnerzahl)

```{r}
# Interaktive Karte: Bezirksregionen
p_bezirksregion <- ggplot(data = berlin_map_durschnitt_bezirksregion) +
  geom_sf(aes(
    fill = durchschnitt_promille,
    text = paste0(
      "Bezirksregion: ", BZR_NAME, 
      "<br>Durchschnitt (Promille): ", round(durchschnitt_promille, 2)
    )
  ), color = "black") +
  scale_fill_gradient(low = "blue", high = "red", name = "Fälle", na.value = "grey") +
  theme_minimal() +
  labs(
    title = "Durchschnitt an Fahrraddiebstähle in Berlin: Bezirksregion",
    subtitle = "Anzahl der Fälle / Anzahl der Einwohner pro Bezirksregion, in Promille",
    caption = "Quelle: Fahrraddiebstahl-Datensatz und LOR-Daten"
  )

# Interaktive Version
interactive_map_bezirksregion <- ggplotly(p_bezirksregion)

# Zeige die interaktive Karte
interactive_map_bezirksregion

# Interaktive Karte: Bezirke
p_bezirk <- ggplot(data = berlin_map_durchschnitt_bezirk) +
  geom_sf(aes(
    fill = durchschnitt_promille,
    text = paste0(
      "Bezirk: ", BEZ, 
      "<br>Durchschnitt (Promille): ", round(durchschnitt_promille, 2)
    )
  ), color = "black") +
  scale_fill_gradient(low = "blue", high = "red", name = "Fälle", na.value = "grey") +
  theme_minimal() +
  labs(
    title = "Durchschnitt an Fahrraddiebstähle in Berlin: Bezirk",
    subtitle = "Anzahl der Fälle / Anzahl der Einwohner pro Bezirk, in Promille",
    caption = "Quelle: Fahrraddiebstahl-Datensatz und LOR-Daten"
  )

# Interaktive Version
interactive_map_bezirk <- ggplotly(p_bezirk)

# Zeige die interaktive Karte
interactive_map_bezirk
```

### Tabellenansicht und Balkendiagram der durchschnittlichen Diebstähle im Bezug zu den Geodaten

```{r}
# Bezirksregionen

# Bezirksregionen sortieren nach dem Durchschnitt in Promille
berlin_map_durschnitt_bezirksregion <- berlin_map_durschnitt_bezirksregion %>%
  arrange(durchschnitt_promille)

# Reihenfolge der Bezirksregionen nach dem Durchschnitt in Promille für ggplot anpassen
berlin_map_durschnitt_bezirksregion$BZR_NAME <- factor(berlin_map_durschnitt_bezirksregion$BZR_NAME, 
                                                       levels = berlin_map_durschnitt_bezirksregion$BZR_NAME[order(berlin_map_durschnitt_bezirksregion$durchschnitt_promille)])

# Aufgeteilter Plot Bezirksregion
split_data_bezirksregion_durchschnitt <- split(berlin_map_durschnitt_bezirksregion, cut(1:nrow(berlin_map_durschnitt_bezirksregion), breaks = 3, labels = FALSE))

# Bestimme den minimalen und maximalen Wert von 'durchschnitt_promille' für den gesamten Datensatz
min_val <- min(berlin_map_durschnitt_bezirksregion$durchschnitt_promille, na.rm = TRUE)
max_val <- max(berlin_map_durschnitt_bezirksregion$durchschnitt_promille, na.rm = TRUE)

# Interaktive Diagramme mit ggplotly
interactive_plots_bezirksregion_durchschnitt <- lapply(1:3, function(i) {
  p <- ggplot(split_data_bezirksregion_durchschnitt[[i]], aes(
      x = BZR_NAME, 
      y = durchschnitt_promille, 
      fill = durchschnitt_promille, 
      text = paste0(
        "Bezirksregion: ", BZR_NAME, 
        "<br>Durchschnitt (Promille): ", round(durchschnitt_promille, 4)
      )
    )) +
    geom_bar(stat = "identity") +
    scale_fill_gradient(low = "blue", high = "red", limits = c(min_val, max_val)) +  # Farbverlauf über alle Plots hinweg
    labs(
      title = paste("Durchschnitt in Promille je Bezirksregion (Teil", i, ")"),
      x = "Bezirksregion",
      y = "Durchschnitt in Promille"
    ) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
  # Konvertiere ggplot-Objekt zu einer interaktiven Version
  ggplotly(p)
})

# Ergebnisse anzeigen
print(interactive_plots_bezirksregion_durchschnitt[[1]])
print(interactive_plots_bezirksregion_durchschnitt[[2]])
print(interactive_plots_bezirksregion_durchschnitt[[3]])
```

### Tabelle und Balkendiagramm des Durchschnitts, Bezirke

```{r}
# Bezirke

# Duplikate in der BEZ-Spalte entfernen und sortieren
berlin_map_durchschnitt_bezirk <- berlin_map_durchschnitt_bezirk %>%
  distinct(BEZ, .keep_all = TRUE) %>%
  arrange(durchschnitt_promille)

# Konvertiere die BEZ-Spalte in einen Faktor mit der aufsteigenden Reihenfolge der anzahl_bezirk
berlin_map_durchschnitt_bezirk$BEZ <- factor(berlin_map_durchschnitt_bezirk$BEZ, levels = berlin_map_durchschnitt_bezirk$BEZ)

# Erstelle das Plot mit Farbverlauf
ggplot(berlin_map_durchschnitt_bezirk, aes(x = BEZ, y = durchschnitt_promille, fill = durchschnitt_promille)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_gradient(low = "blue", high = "red") +  # Farbverlauf
  labs(
    title = "Durchschnitt der Fahrraddiebstähle je Bezirk",
    x = "Bezirk",
    y = "Durchscnitt der Fälle"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Diebstähle nach Fahrradarten

### Art der Fahrräder Vergleich:

```{r}
# Tabelle erstellen
tabelle_fahrrad_art <- table(fahrraddiebstahl_datensatz['ART_DES_FAHRRADS'])

# Tabelle in ein Dataframe umwandeln
tabelle_fahrrad_art_df <- as.data.frame(tabelle_fahrrad_art)

# Spalten umbenennen
colnames(tabelle_fahrrad_art_df) <- c("ART_DES_FAHRRADS", "ANZAHL")

# Sicherstellen, dass ANZAHL numerisch ist
tabelle_fahrrad_art_df$ANZAHL <- as.numeric(tabelle_fahrrad_art_df$ANZAHL)

# Plotly Treemap erstellen
library(plotly)

plot_ly(
  tabelle_fahrrad_art_df, 
  type = "treemap",
  labels = tabelle_fahrrad_art_df$ART_DES_FAHRRADS,  # Labels
  parents = rep("", nrow(tabelle_fahrrad_art_df)),  # Keine Hierarchie
  values = tabelle_fahrrad_art_df$ANZAHL,  # Werte
  textinfo = "label+value",   # Anzeige von Label und Wert
  hoverinfo = "label+value",  # Anzeige von Label und Wert beim Hover
  marker = list(
    colors = tabelle_fahrrad_art_df$ANZAHL,
    colorscale = "Greens",    # Farbabstufung
    line = list(color = "white", width = 0.5)
  )
) %>%
  layout(
    title = "Treemap: Arten von Fahrrädern und Diebstahlanzahl"
  )

```

### Verteilung Delikte

```{r}
# Tabelle erstellen
tabelle_delikte <- table(fahrraddiebstahl_datensatz['DELIKT'])

# Tabelle in ein Dataframe umwandeln
tabelle_delikte_df <- as.data.frame(tabelle_delikte)
colnames(tabelle_delikte_df) <- c("Delikt", "Anzahl")

# Prozentwerte berechnen
tabelle_delikte_df <- tabelle_delikte_df %>%
  mutate(Prozent = round((Anzahl / sum(Anzahl)) * 100, 1),
         Label = paste0(Delikt, ": ", Anzahl, " (", Prozent, "%)"))

# Interaktives Kuchendiagramm mit plotly
kuchendiagramm_delikte <- plot_ly(
  tabelle_delikte_df,
  labels = ~Delikt,
  values = ~Anzahl,
  type = 'pie',
  textinfo = 'none',  # Entfernt Beschriftung auf dem Chart
  hoverinfo = 'text', # Zeigt Informationen nur beim Hovern
  text = ~Label
)

# Diagramm und Layout gestalten
kuchendiagramm_delikte <- kuchendiagramm_delikte %>% layout(
  title = "Interaktives Kuchendiagramm der Delikte",
  showlegend = TRUE,
  legend = list(
    x = 1.05,    # Position rechts außerhalb des Charts
    y = 0.5,     # Vertikal mittig (50% der Höhe)
    valign = "middle"
  ),
  margin = list(l = 50, r = 150, t = 50, b = 50), # Platz für die Legende rechts
  xaxis = list(showgrid = FALSE, zeroline = FALSE),
  yaxis = list(showgrid = FALSE, zeroline = FALSE)
)

# Diagramm anzeigen
kuchendiagramm_delikte
```

### Verteilung Erfassungsgrund:

```{r}
# Tabelle erstellen
tabelle_erfassungsgrund <- table(fahrraddiebstahl_datensatz['ERFASSUNGSGRUND'])

# Tabelle in ein Dataframe umwandeln
tabelle_erfassungsgrund_df <- as.data.frame(tabelle_erfassungsgrund)
colnames(tabelle_erfassungsgrund_df) <- c("Erfassungsgrund", "Anzahl")

# Prozentwerte berechnen
tabelle_erfassungsgrund_df <- tabelle_erfassungsgrund_df %>%
  mutate(Prozent = round((Anzahl / sum(Anzahl)) * 100, 1),
         Label = paste0(Erfassungsgrund, ": ", Anzahl, " (", Prozent, "%)"))

# Interaktives Kuchendiagramm mit plotly
kuchendiagramm_erfassungsgrund <- plot_ly(
  tabelle_erfassungsgrund_df,
  labels = ~Erfassungsgrund,
  values = ~Anzahl,
  type = 'pie',
  textinfo = 'none',
  hoverinfo = 'text',
  text = ~Label
)

# Diagramm gestalten
kuchendiagramm_erfassungsgrund <- kuchendiagramm_erfassungsgrund %>% layout(
  title = "Interaktives Kuchendiagramm der Erfassungsgründe",
  showlegend = TRUE,
  legend = list(
    x = 1.05,    # Position rechts außerhalb des Charts
    y = 0.5,     # Vertikal mittig (50% der Höhe)
    valign = "middle"
  ),
  margin = list(l = 50, r = 150, t = 50, b = 50), # Platz für die Legende rechts
  xaxis = list(showgrid = FALSE, zeroline = FALSE),
  yaxis = list(showgrid = FALSE, zeroline = FALSE)
)

# Diagramm anzeigen
kuchendiagramm_erfassungsgrund
```

# Schadenshöhe

```{r}
# Gesamtzahl und Durchschnitt der Schadenshöhe je Fahrradart berechnen
fahrrad_schaden_stats <- aggregate(SCHADENSHOEHE ~ ART_DES_FAHRRADS, 
                                   data = fahrraddiebstahl_datensatz, 
                                   FUN = function(x) c(Gesamt = sum(x), Durchschnitt = mean(x)))

# Ergebnis als DataFrame umwandeln
fahrrad_schaden_stats_df <- do.call(data.frame, fahrrad_schaden_stats)

# Tabelle mit den gestohlenen Fahrrädern und den Schadenshöhen zusammenführen
fahrrad_schaden_stats_df <- merge(tabelle_fahrrad_art_df, fahrrad_schaden_stats_df, by = "ART_DES_FAHRRADS")
```

```{r}
fahrrad_schaden_stats_df
```

## Schadenshöhe je Region/Bezirk

### Datenpräparation

#### Absolute Schadenshöhe

```{r}
# Betriebsregion
lor_schadenshöhe_bezirksregion <- fahrraddiebstahl_datensatz %>%
  mutate(LOR = as.character(LOR),  # Stelle sicher, dass LOR als Zeichenkette behandelt wird
         LOR = substr(LOR, 1, 6)) %>%  # Extrahiere die ersten 6 Zeichen der LOR
  group_by(LOR) %>%  # Nach den ersten 6 Zeichen der LOR gruppieren
  summarise(SCHADENSHOEHE_SUMME = sum(SCHADENSHOEHE, na.rm = TRUE), .groups = "drop")  # Summiere die Schadenshöhe

# Zusammenführen der Fahrraddiebstahldaten mit der Berlin-Karte
berlin_map_schadenshöhe_bezirksregion <- berlin_map %>%
  left_join(lor_schadenshöhe_bezirksregion, by = c("BZR_ID" = "LOR"))


# Bezirk
lor_schadenshöhe_bezirk <- fahrraddiebstahl_datensatz %>%
  mutate(LOR = as.character(LOR),  # Stelle sicher, dass LOR als Zeichenkette behandelt wird
         LOR = substr(LOR, 1, 2)) %>%  # Extrahiere die ersten 2 Zeichen der LOR
  group_by(LOR) %>%  # Nach den ersten 2 Zeichen der LOR gruppieren
  summarise(SCHADENSHOEHE_SUMME = sum(SCHADENSHOEHE, na.rm = TRUE), .groups = "drop")  # Summiere die Schadenshöhe

# Zusammenführen der Fahrraddiebstahldaten mit der Berlin-Karte
berlin_map_schadenshöhe_bezirk <- berlin_map %>%
  left_join(lor_schadenshöhe_bezirk, by = c("BEZ" = "LOR"))
```

#### Durchschnittliche Schadenshöhe

```{r}
# Betriebsregion

# Präpariere den Datensatz
lor_schadenshöhe_durchschnitt_bezirksregion <- fahrraddiebstahl_und_lor_df %>%
  mutate(LOR = as.character(LOR),  # Stelle sicher, dass LOR als Zeichenkette behandelt wird
         LOR = substr(LOR, 1, 6),  # Extrahiere die ersten 6 Zeichen der LOR
         Einwohner = as.numeric(Einwohner)) %>%  # Konvertiere Einwohner in numerische Werte
  group_by(LOR) %>%  # Nach den ersten 6 Zeichen der LOR gruppieren
  summarise(SCHADENSHOEHE_SUMME = sum(SCHADENSHOEHE, na.rm = TRUE),
            Einwohner = sum(Einwohner, na.rm = TRUE), .groups = "drop") %>%  # Berechne die Summe der Einwohner pro LOR
  mutate(SCHADENSHOEHE_DURCHSCHNITT = (SCHADENSHOEHE_SUMME / Einwohner) * 1000)  # Berechne Promille

# Zusammenführen der Fahrraddiebstahldaten mit der Berlin-Karte
berlin_map_schadenshöhe_durschnitt_bezirksregion <- berlin_map %>%
  left_join(lor_schadenshöhe_durchschnitt_bezirksregion, by = c("BZR_ID" = "LOR"))

# Bezirk

# Präpariere den Datensatz
lor_schadenshöhe_durchschnitt_bezirk <- fahrraddiebstahl_und_lor_df %>%
  mutate(LOR = as.character(LOR),  # Stelle sicher, dass LOR als Zeichenkette behandelt wird
         LOR = substr(LOR, 1, 2),  # Extrahiere die ersten 2 Zeichen der LOR
         Einwohner = as.numeric(Einwohner)) %>%  # Stelle sicher, dass Einwohner numerisch ist
  group_by(LOR) %>%  # Nach den ersten 2 Zeichen der LOR gruppieren
  summarise(SCHADENSHOEHE_SUMME = sum(SCHADENSHOEHE, na.rm = TRUE),
            Einwohner = sum(Einwohner, na.rm = TRUE), .groups = "drop") %>%  # Berechne die Summe der Einwohner pro LOR
  mutate(SCHADENSHOEHE_DURCHSCHNITT = (SCHADENSHOEHE_SUMME / Einwohner) * 1000)  # Berechne Promille

# Zusammenführen der Fahrraddiebstahldaten mit der Berlin-Karte
berlin_map_schadenshöhe_durchschnitt_bezirk <- berlin_map %>%
  left_join(lor_schadenshöhe_durchschnitt_bezirk, by = c("BEZ" = "LOR"))
```

### Visualisierung der absoluten Schadenshöhe in einer Karte & Tabelle

ME

```{r}
# Interaktive Karte: Bezirksregionen
p_schadenshoehe_bezirksregion <- ggplot(data = berlin_map_schadenshöhe_bezirksregion) +
  geom_sf(aes(
    fill = SCHADENSHOEHE_SUMME,  # Füllung basierend auf Schadenshöhe
    text = paste(
      "Bezirksregion:", BZR_NAME, "<br>",
      "Schadenshöhe (€):", SCHADENSHOEHE_SUMME
    )  # Tooltip-Inhalt
  ), color = "black") +
  scale_fill_gradient(low = "blue", high = "red", name = "Schadenshöhe (€)", na.value = "grey") +
  theme_minimal() +
  labs(
    title = "Absolute Schadenshöhe bei Fahrraddiebstählen in Berlin: Bezirksregion",
    subtitle = "Schadenshöhe in Euro pro Bezirksregion",
    caption = "Quelle: Fahrraddiebstahl-Datensatz und LOR-Daten"
  )

# Interaktive Version
interactive_map_schadenshoehe_bezirksregion <- ggplotly(p_schadenshoehe_bezirksregion, tooltip = "text")

# Zeige die interaktive Karte
interactive_map_schadenshoehe_bezirksregion

```

```{r}
# Interaktive Karte: Bezirke
p_schadenshoehe_bezirk <- ggplot(data = berlin_map_schadenshöhe_bezirk) +
  geom_sf(aes(
    fill = SCHADENSHOEHE_SUMME / 1000,  # Schadenshöhe in Tausend Euro
    text = paste(
      "Bezirk:", BZR_NAME, "<br>",
      "Schadenshöhe (T€):", round(SCHADENSHOEHE_SUMME / 1000, 1)
    )  # Tooltip-Inhalt
  ), color = "black") +
  scale_fill_gradient(low = "blue", high = "red", name = "Schadenshöhe (T€)", na.value = "grey") +
  theme_minimal() +
  labs(
    title = "Absolute Schadenshöhe bei Fahrraddiebstählen in Berlin: Bezirk",
    subtitle = "Schadenshöhe in Tausend Euro pro Bezirk",
    caption = "Quelle: Fahrraddiebstahl-Datensatz und LOR-Daten"
  )

# Interaktive Version
interactive_map_schadenshoehe_bezirk <- ggplotly(p_schadenshoehe_bezirk, tooltip = "text")

# Zeige die interaktive Karte
interactive_map_schadenshoehe_bezirk
```

```{r}
# Bezirksregionen
berlin_map_schadenshöhe_bezirksregion %>%
  select(BZR_NAME, BZR_ID, SCHADENSHOEHE_SUMME) %>%
  st_drop_geometry() %>%  # Entfernt die Geometrie-Daten
   arrange(desc(SCHADENSHOEHE_SUMME)) %>%  # Sortiert in absteigender Reihenfolge
  show()

# Bezirke
berlin_map_schadenshöhe_bezirksregion %>%
  select(BEZ, SCHADENSHOEHE_SUMME) %>%
  st_drop_geometry() %>%  # Entfernt die Geometrie-Daten
   distinct(BEZ, .keep_all = TRUE) %>%  # Entfernt Duplikate basierend auf 'BEZ'
   arrange(desc(SCHADENSHOEHE_SUMME)) %>%  # Sortiert in absteigender Reihenfolge
  show()
```

### Visualisierung der durchschnittlichen Schadenshöhe in einer Karte & Tabelle

```{r}
# Interaktive Karte nur Bezirk
p_reg <- ggplot(data = berlin_map_schadenshöhe_durschnitt_bezirksregion) +
  geom_sf(aes(
    fill = SCHADENSHOEHE_DURCHSCHNITT,
    text = paste0("Bezirksregion: ", BZR_NAME, "<br>Durchschnitt der Schadenshöhe: ", SCHADENSHOEHE_DURCHSCHNITT)
  ), color = "black") +
  scale_fill_gradient(low = "blue", high = "red", name = "Fälle", na.value = "grey") +
  theme_minimal() +
  labs(
    title = "Absolute Anzahl an Fahrraddiebstähle in Berlin: Bezirk",
    subtitle = "Anzahl der Fälle pro Bezirk",
    caption = "Quelle: Fahrraddiebstahl-Datensatz und LOR-Daten"
  )

# Interaktive Version der Karte
interactive_map_reg <- ggplotly(p_reg)

# Zeige die interaktive Karte
interactive_map_reg

# Interaktive Karte nur Bezirk
p_bez <- ggplot(data = berlin_map_schadenshöhe_durchschnitt_bezirk) +
  geom_sf(aes(
    fill = SCHADENSHOEHE_DURCHSCHNITT,
    text = paste0("Bezirksregion: ", BEZ, "<br>Durchschnitt der Schadenshöhe: ", SCHADENSHOEHE_DURCHSCHNITT)
  ), color = "black") +
  scale_fill_gradient(low = "blue", high = "red", name = "Fälle", na.value = "grey") +
  theme_minimal() +
  labs(
    title = "Absolute Anzahl an Fahrraddiebstähle in Berlin: Bezirk",
    subtitle = "Anzahl der Fälle pro Bezirk",
    caption = "Quelle: Fahrraddiebstahl-Datensatz und LOR-Daten"
  )

# Interaktive Version der Karte
interactive_map_bez <- ggplotly(p_bez)

# Zeige die interaktive Karte
interactive_map_bez
```

```{r}
# Interaktive Karte: Bezirksregionen
p_schadenshoehe_durchschnitt_bezirksregion <- ggplot(data = berlin_map_schadenshöhe_durschnitt_bezirksregion) +
  geom_sf(aes(
    fill = SCHADENSHOEHE_DURCHSCHNITT,
    text = paste0(
      "Bezirksregion: ", BZR_NAME, 
      "<br>Durchschnittliche Schadenshöhe: ", scales::comma(round(SCHADENSHOEHE_DURCHSCHNITT, 2)), " €"
    )
  ), color = "black") +
  scale_fill_gradient(low = "blue", high = "red", name = "Durchschnitt (€)", na.value = "grey") +
  theme_minimal() +
  labs(
    title = "Durchschnitt der Schadenshöhe von Fahrraddiebstählen in Berlin: Bezirksregion",
    subtitle = "Durchschnitt: Schadenshöhe / Anzahl der Einwohner pro Bezirksregion",
    caption = "Quelle: Fahrraddiebstahl-Datensatz und LOR-Daten"
  )

# Interaktive Version
interactive_map_schadenshoehe_durchschnitt_bezirksregion <- ggplotly(p_schadenshoehe_durchschnitt_bezirksregion)

# Zeige die interaktive Karte
interactive_map_schadenshoehe_durchschnitt_bezirksregion

# Interaktive Karte: Bezirke
p_schadenshoehe_durchschnitt_bezirk <- ggplot(data = berlin_map_schadenshöhe_durchschnitt_bezirk) +
  geom_sf(aes(
    fill = SCHADENSHOEHE_DURCHSCHNITT,
    text = paste0(
      "Bezirk: ", BEZ, 
      "<br>Durchschnittliche Schadenshöhe: ", scales::comma(round(SCHADENSHOEHE_DURCHSCHNITT, 2)), " €"
    )
  ), color = "black") +
  scale_fill_gradient(low = "blue", high = "red", name = "Durchschnitt (€)", na.value = "grey") +
  theme_minimal() +
  labs(
    title = "Durchschnitt der Schadenshöhe von Fahrraddiebstählen in Berlin: Bezirk",
    subtitle = "Durchschnitt: Schadenshöhe / Anzahl der Einwohner pro Bezirk",
    caption = "Quelle: Fahrraddiebstahl-Datensatz und LOR-Daten"
  )

# Interaktive Version
interactive_map_schadenshoehe_durchschnitt_bezirk <- ggplotly(p_schadenshoehe_durchschnitt_bezirk)

# Zeige die interaktive Karte
interactive_map_schadenshoehe_durchschnitt_bezirk
```

# Analyse der Diebstähle nach Tagzeiten

## Präparation des Datensatz

### \# Umwandlung und Präparation der Diebstahlszeien

```{r}
fahrraddiebstahl_dauer_df <- fahrraddiebstahl_datensatz_df

# Umwandlung von Tatzeit Anfang in POSIXct
fahrraddiebstahl_dauer_df$TATZEIT_ANFANG <- as.POSIXct(
  paste(fahrraddiebstahl_dauer_df$TATZEIT_ANFANG_DATUM, fahrraddiebstahl_dauer_df$TATZEIT_ANFANG_STUNDE),
  format = "%d.%m.%Y %H"
)

# Umwandlung von Tatzeit Ende in POSIXct
fahrraddiebstahl_dauer_df$TATZEIT_ENDE <- as.POSIXct(
  paste(fahrraddiebstahl_dauer_df$TATZEIT_ENDE_DATUM, fahrraddiebstahl_dauer_df$TATZEIT_ENDE_STUNDE),
  format = "%d.%m.%Y %H"
)

# Berechnung der Dauer in Stunden
fahrraddiebstahl_dauer_df$Dauer <- as.numeric(
  difftime(fahrraddiebstahl_dauer_df$TATZEIT_ENDE, fahrraddiebstahl_dauer_df$TATZEIT_ANFANG, units = "hours"))
```

### \# Aufteilung nacht tagsüber/nachts und mehrere Tage

```{r}
# Tagsüber: Tatzeit zwischen 6 und 18 Uhr und Dauer <= 24 Stunden
fahrraddiebstahl_dauer_tagsüber_df <- subset(
  fahrraddiebstahl_dauer_df,
  as.numeric(format(TATZEIT_ANFANG, "%H")) > 6 & as.numeric(format(TATZEIT_ANFANG, "%H")) < 18 &
    Dauer <= 24
)

# Nachts: Tatzeit >= 18 Uhr oder < 6 Uhr und Dauer <= 24 Stunden
fahrraddiebstahl_dauer_nachts_df <- subset(
  fahrraddiebstahl_dauer_df,
  (as.numeric(format(TATZEIT_ANFANG, "%H")) >= 18 | as.numeric(format(TATZEIT_ANFANG, "%H")) < 6) &
    Dauer <= 24
)

# Über mehrere Tage: Dauer > 24 Stunden
fahrraddiebstahl_dauer_mehrere_tage_df <- subset(
  fahrraddiebstahl_dauer_df,
  Dauer > 24
)
```

## Kennzahlen

### \# Durchschnittszeiten

```{r}
# Berechnung des Durchschnitts der allgemeinen Dauer
durchschnitt <- mean(fahrraddiebstahl_dauer_df$Dauer, na.rm = TRUE)
print(paste("Durchschnittszeit einer Diebstahlsdauer beträgt:", durchschnitt))
```

### \# Zusammenfassung der Diebstahlsdauerzeiten

```{r}
cat("Zusammenfassungen der Diebstahlsdauerzeiten")
cat("\nAllgemein:\n")
summary(fahrraddiebstahl_dauer_df$Dauer)

cat("\nTagsüber:\n")
summary(fahrraddiebstahl_dauer_tagsüber_df$Dauer)

cat("\nNachts:\n")
summary(fahrraddiebstahl_dauer_nachts_df$Dauer)

cat("\nMehrere Tage:\n")
summary(fahrraddiebstahl_dauer_mehrere_tage_df$Dauer)
```

### \# Dauer Verteilungsfuktion

```{r}
#Importiere Bibliothek
library(ggplot2)

# Tagsüber
ggplot(data = fahrraddiebstahl_dauer_tagsüber_df, aes(x = Dauer)) +
  geom_bar(fill = "cyan4") +
  labs(
    title = "Verteilung der Diebstahldauer tagsüber",
    x = "Dauer (Stunden)",
    y = "Anzahl der Fälle"
  ) +
  scale_x_continuous(breaks = seq(0, max(fahrraddiebstahl_dauer_tagsüber_df$Dauer), by = 1),
                     labels = function(x) ifelse(x == 0, "<1", x)) +
  theme_minimal()

# Nachts
ggplot(data = fahrraddiebstahl_dauer_nachts_df, aes(x = Dauer)) +
  geom_bar(fill = "cyan4") +
  labs(
    title = "Verteilung der Diebstahldauer nachts",
    x = "Dauer (Stunden)",
    y = "Anzahl der Fälle"
  ) +
  scale_x_continuous(breaks = seq(0, max(fahrraddiebstahl_dauer_nachts_df$Dauer), by = 1),
                     labels = function(x) ifelse(x == 0, "<1", x)) +
  theme_minimal()

# mehrere Tage
ggplot(data = fahrraddiebstahl_dauer_mehrere_tage_df, aes(x = Dauer)) +
  geom_bar(fill = "cyan4") +
  labs(
    title = "Verteilung der Diebstahldauer mehrere Tage",
    x = "Dauer (Stunden)",
    y = "Anzahl der Fälle"
  ) +
  scale_x_continuous(breaks = seq(0, max(fahrraddiebstahl_dauer_mehrere_tage_df$Dauer), by = 5),
                     labels = function(x) ifelse(x == 0, "<1", x)) +
  theme_minimal()
```

## Anzahl der Tatzeiten nach Stunde

Mit diesem Kapitel der Datenanalyse sollen präferierte Tatzeiten herausgefunden werden.

### Absolute Anzahl der Anfänge der Tatzeiten nach Stunde

```{r}
fahrraddiebstahl_anzahl_df <- fahrraddiebstahl_datensatz_df

# Convert `TATZEIT_ANFANG_STUNDE` to numeric to avoid NA errors
fahrraddiebstahl_anzahl_df$TATZEIT_STUNDE_ANZAHL <- as.numeric(fahrraddiebstahl_anzahl_df$TATZEIT_ANFANG_STUNDE)


# Konvertiere `TATZEIT_ANFANG_STUNDE` in numerisch, um Fehler mit NA-Werten zu vermeiden
fahrraddiebstahl_anzahl_df$TATZEIT_STUNDE_ANZAHL <- as.numeric(fahrraddiebstahl_datensatz_df$TATZEIT_ANFANG_STUNDE)

# Gruppiere nach `TATZEIT_ANFANG_STUNDE` und zähle die Anzahl der Fälle je Stunde
library(dplyr)

stunden_anzahl <- fahrraddiebstahl_anzahl_df %>%
  filter(!is.na(TATZEIT_STUNDE_ANZAHL)) %>% # NA-Werte entfernen
  group_by(TATZEIT_STUNDE_ANZAHL) %>%
  summarise(Anzahl = n())

# Plot als Balkendiagramm
ggplot(stunden_anzahl, aes(x = TATZEIT_STUNDE_ANZAHL, y = Anzahl)) +
  geom_bar(stat = "identity", fill = "cyan4") +
  labs(
    title = "Absolute Anzahl der Anfänge von Fahrraddiebstählen je Stunde",
    x = "Stunde des Tages",
    y = "Anzahl der Fälle"
  ) +
  theme_minimal()

# print(stunden_anzahl)
```

### Absolute Anzahl der Endzeiten der Diebstähle nach Stunde

```{r}
# Konvertiere `TATZEIT_ANFANG_STUNDE` in numerisch, um Fehler mit NA-Werten zu vermeiden
fahrraddiebstahl_anzahl_df$TATZEIT_STUNDE_ANZAHL <- as.numeric(fahrraddiebstahl_datensatz_df$TATZEIT_ENDE_STUNDE)

# Gruppiere nach `TATZEIT_ANFANG_STUNDE` und zähle die Anzahl der Fälle je Stunde
library(dplyr)

stunden_anzahl <- fahrraddiebstahl_anzahl_df %>%
  filter(!is.na(TATZEIT_STUNDE_ANZAHL)) %>% # NA-Werte entfernen
  group_by(TATZEIT_STUNDE_ANZAHL) %>%
  summarise(Anzahl = n())

# Plot als Balkendiagramm
ggplot(stunden_anzahl, aes(x = TATZEIT_STUNDE_ANZAHL, y = Anzahl)) +
  geom_bar(stat = "identity", fill = "cyan4") +
  labs(
    title = "Absolute Anzahl der Enden von Fahrraddiebstählen je Stunde",
    x = "Stunde des Tages",
    y = "Anzahl der Fälle"
  ) +
  theme_minimal()

# print(stunden_anzahl)
```

Dabei ist abzuwägen, was "Anfang des Fahrraddiebstahls" bedeutet. Die Personen, die die Fälle gemeldet haben, werden vermutlich dort das Rad zuletzt gesehen haben.

## Anzahl der Diebstähle nach Ort+Uhrzeit

```{r}
# Datensatz nach Bezirk und Stunde gruppieren, nur mit den ersten 6 Zeichen von LOR
lor_zeit_anzahl <- fahrraddiebstahl_datensatz_df %>%
  mutate(LOR = substr(LOR, 1, 6)) %>%  # Nur die ersten 6 Zeichen von LOR verwenden
  group_by(LOR, TATZEIT_ANFANG_STUNDE) %>%
  summarise(anzahl_diebstahl = n(), .groups = "drop") %>%
  arrange(LOR, desc(anzahl_diebstahl))

# Höchste und zweitmeiste Diebstähle pro LOR ermitteln
lor_max_zeit <- lor_zeit_anzahl %>%
  group_by(LOR) %>%
  summarise(
    max_anzahl = max(anzahl_diebstahl),
    max_zeit = TATZEIT_ANFANG_STUNDE[which.max(anzahl_diebstahl)],
    zweitmax_anzahl = sort(anzahl_diebstahl, decreasing = TRUE)[2],
    zweitmax_zeit = TATZEIT_ANFANG_STUNDE[order(anzahl_diebstahl, decreasing = TRUE)][2],
    .groups = "drop"
  )

# Zusammenführen der Fahrraddiebstahldaten mit den Bezirksdaten
berlin_map_bezirksregion <- berlin_map %>%
  left_join(lor_max_zeit, by = c("BZR_ID" = "LOR"))

# Basis-Karte erstellen
p_reg <- ggplot(data = berlin_map_bezirksregion) +
  geom_sf(aes(
    fill = factor(max_zeit),  # Farbe nach der Stunde mit den meisten Diebstählen
    text = paste0("Bezirk: ", BZR_NAME, 
                  "<br>Höchste Fälle um ", max_zeit, " Uhr: ", max_anzahl,
                  "<br>Zweitmeiste Fälle um ", zweitmax_zeit, " Uhr: ", zweitmax_anzahl)
  ), color = "black") +
  scale_fill_viridis_d(name = "Uhrzeit") +  # Alternativ: Verwende das "viridis"-Farbschema
  theme_minimal() +
  labs(
    title = "Fahrraddiebstähle in Berlin: Bezirke und Uhrzeiten",
    subtitle = "Uhrzeit mit den meisten Diebstählen (Uhrzeit Anfang) pro Bezirk",
    caption = "Quelle: Fahrraddiebstahl-Datensatz"
  )

# Interaktive Karte mit Plotly
interactive_map_reg <- ggplotly(p_reg)
# Zeige die interaktive Karte
interactive_map_reg
```

```{r}
# Datensatz nach Bezirk und Stunde gruppieren, nur mit den ersten 6 Zeichen von LOR
lor_zeit_anzahl <- fahrraddiebstahl_datensatz_df %>%
  mutate(LOR = substr(LOR, 1, 6)) %>%  # Nur die ersten 6 Zeichen von LOR verwenden
  group_by(LOR, TATZEIT_ENDE_STUNDE) %>%
  summarise(anzahl_diebstahl = n(), .groups = "drop") %>%
  arrange(LOR, desc(anzahl_diebstahl))

# Höchste und zweitmeiste Diebstähle pro LOR ermitteln
lor_max_zeit <- lor_zeit_anzahl %>%
  group_by(LOR) %>%
  summarise(
    max_anzahl = max(anzahl_diebstahl),
    max_zeit = TATZEIT_ENDE_STUNDE[which.max(anzahl_diebstahl)],
    zweitmax_anzahl = sort(anzahl_diebstahl, decreasing = TRUE)[2],
    zweitmax_zeit = TATZEIT_ENDE_STUNDE[order(anzahl_diebstahl, decreasing = TRUE)][2],
    .groups = "drop"
  )

# Zusammenführen der Fahrraddiebstahldaten mit den Bezirksdaten
berlin_map_bezirksregion <- berlin_map %>%
  left_join(lor_max_zeit, by = c("BZR_ID" = "LOR"))

# Basis-Karte erstellen
p_reg <- ggplot(data = berlin_map_bezirksregion) +
  geom_sf(aes(
    fill = factor(max_zeit),  # Farbe nach der Stunde mit den meisten Diebstählen
    text = paste0("Bezirk: ", BZR_NAME, 
                  "<br>Höchste Fälle um ", max_zeit, " Uhr: ", max_anzahl,
                  "<br>Zweitmeiste Fälle um ", zweitmax_zeit, " Uhr: ", zweitmax_anzahl)
  ), color = "black") +
  scale_fill_viridis_d(name = "Uhrzeit") +  # Alternativ: Verwende das "viridis"-Farbschema
  theme_minimal() +
  labs(
    title = "Fahrraddiebstähle in Berlin: Bezirke und Uhrzeiten",
    subtitle = "Uhrzeit mit den meisten Diebstählen (Uhrzeit Ende) pro Bezirk",
    caption = "Quelle: Fahrraddiebstahl-Datensatz"
  )

# Interaktive Karte mit Plotly
interactive_map_reg_uhrzeit <- ggplotly(p_reg)
# Zeige die interaktive Karte
interactive_map_reg_uhrzeit
```

## Anzahl der Tatzeiten je Tag/Monat

Diese Kapitel analysiert die Anzahlen der Diebstähle an den unterschiedlichen Tagen und Monaten. Dabei wird das Datum genommen, in dem das Fahrrad sicher gestohlen ist, also die Einträge aus "TATZEIT_ENDE_DATUM".

### Präparation des Datensatzen

```{r}
# Annahme: fahrraddiebstahl_datensatz_df enthält eine Spalte `TATZEIT_ANFANG_DATUM` im Format "%d.%m.%Y"
fahrraddiebstahl_datensatz_Anzahl_df <- fahrraddiebstahl_datensatz_df %>%
  mutate(
    TATZEIT_DATUM_ANZAHL = as.Date(TATZEIT_ENDE_DATUM, format = "%d.%m.%Y"), # Konvertierung zu Datum
    Monat = month(TATZEIT_DATUM_ANZAHL, label = TRUE, abbr = TRUE) # Extrahiere den Monat
  )

# Gruppiere nach `TATZEIT_DATUM_ANZAHL` und zähle die Anzahl der Fälle je Datum
datum_anzahl <- fahrraddiebstahl_datensatz_Anzahl_df %>%
  filter(!is.na(TATZEIT_DATUM_ANZAHL)) %>% # NA-Werte entfernen
  group_by(TATZEIT_DATUM_ANZAHL, Monat) %>% # Gruppiere auch nach Monat
  summarise(Anzahl = n(), .groups = "drop")
```

### Anzahl der Fälle von Fahrraddiebstählen nach Tag

```{r}
# Plot mit unterschiedlichen Farben für die Monate
ggplot(datum_anzahl, aes(x = TATZEIT_DATUM_ANZAHL, y = Anzahl, fill = Monat)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Fälle von Fahrraddiebstählen je Datum",
    x = "Datum",
    y = "Anzahl der Fälle",
    fill = "Monat"
  ) +
  theme_minimal()
```

### Absolute Anzahl der Diebstähle je Wochentag + Monat

```{r}
fahrraddiebstahl_datensatz_df <- fahrraddiebstahl_datensatz_df %>%
  mutate(
    TATZEIT_DATUM_ANZAHL = as.Date(TATZEIT_ANFANG_DATUM, format = "%d.%m.%Y"), # Konvertierung zu Datum
    Monat = month(TATZEIT_DATUM_ANZAHL, label = TRUE, abbr = TRUE), # Extrahiere den Monat
    Wochentag = wday(TATZEIT_DATUM_ANZAHL, label = TRUE) # Extrahiere den Wochentag
  )

# Gruppiere nach `Wochentag` und `Monat` und zähle die Anzahl der Fälle je Wochentag und Monat
wochentag_monat_anzahl <- fahrraddiebstahl_datensatz_df %>%
  filter(!is.na(TATZEIT_DATUM_ANZAHL)) %>% # Filtere NA-Werte
  group_by(Wochentag, Monat) %>% # Gruppiere nach Wochentag und Monat
  summarise(Anzahl = n(), .groups = "drop")

# Erstelle das Plot
ggplot(wochentag_monat_anzahl, aes(x = Wochentag, y = Anzahl, fill = Monat)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Anzahl der Fahrraddiebstähle pro Wochentag und Monat",
    x = "Wochentag",
    y = "Anzahl der Diebstähle",
    fill = "Monat"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# print(wochentag_monat_anzahl)
```

### Durchschnittliche Anzahl der Diebstähle nach Wochentag

```{r}
fahrraddiebstahl_datensatz_df <- fahrraddiebstahl_datensatz_df %>%
  mutate(
    TATZEIT_DATUM_ANZAHL = as.Date(TATZEIT_ANFANG_DATUM, format = "%d.%m.%Y"), # Konvertierung zu Datum
    Wochentag = wday(TATZEIT_DATUM_ANZAHL, label = TRUE) # Extrahiere den Wochentag
  )

# Gruppiere nach `Wochentag` und zähle die Anzahl der Fälle je Wochentag über alle Monate hinweg
wochentag_anzahl <- fahrraddiebstahl_datensatz_df %>%
  filter(!is.na(TATZEIT_DATUM_ANZAHL)) %>% # Filtere NA-Werte
  group_by(Wochentag) %>% # Gruppiere nur nach Wochentag
  summarise(Anzahl = n(), .groups = "drop")

# Berechne die durchschnittliche Anzahl der Diebstähle pro Wochentag
durchschnitt_wochentag <- wochentag_anzahl %>%
  mutate(Durchschnitt = Anzahl) # Berechne den Durchschnitt pro Wochentag

# Erstelle das Plot
ggplot(wochentag_anzahl, aes(x = Wochentag, y = Anzahl, fill = Wochentag)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Anzahl der Fahrraddiebstähle pro Wochentag (alle Monate)",
    x = "Wochentag",
    y = "Anzahl der Diebstähle"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# print(durchschnitt_wochentag)
```

### Anzahl der Fälle von Fahrraddiebstählen nach Monat+Jahr

```{r}
# Jahr und Monat extrahieren
fahrraddiebstahl_datensatz_df <- fahrraddiebstahl_datensatz_df %>%
  mutate(
    Jahr = year(TATZEIT_DATUM_ANZAHL),          # Extrahiere das Jahr
    Monat = month(TATZEIT_DATUM_ANZAHL, label = TRUE, abbr = TRUE) # Extrahiere den Monat
  )

# Daten nach Monat und Jahr aggregieren
monat_jahr_anzahl <- fahrraddiebstahl_datensatz_df %>%
  filter(!is.na(TATZEIT_DATUM_ANZAHL)) %>%
  group_by(Jahr, Monat) %>%
  summarise(Anzahl = n(), .groups = "drop")

# Plot erstellen
ggplot(monat_jahr_anzahl, aes(x = Monat, y = Anzahl, fill = factor(Jahr))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_brewer(palette = "Set1") + # Farbpalette für Jahre
  labs(
    title = "Fälle von Fahrraddiebstählen je Monat und Jahr",
    x = "Monat",
    y = "Anzahl der Fälle",
    fill = "Jahr"
  ) +
  theme_minimal()

```

In dem Balkendiagramm wird ersichtlich, dass die Fahrradiebstähle im Jahr 2024 in den Monaten Januar bis September geringer ausfallen. Die Einzeige Ausnahme stellt der Monat Mai dar.

### Durchschnittliche Anzahl der Fälle von Fahrraddiebstählen nach Monat

In diesem Unterkapitel wird die Durchschnittliche Anzahl der Monate gezeigt. Da der Datensatz aus zwei Jahren besteht, werden die Anzähle durch zwei dividiert. Die Monate Oktober, November sowie Dezember bilden dabei eine Ausnahme, da im Jahr 2024 die Daten nur bis einschließlich 18.Oktober.2024 vorhanden sind.

```{r}
# Monatsspezifische Anpassungen der Anzahl
monat_anzahl <- fahrraddiebstahl_datensatz_df %>%
  filter(!is.na(TATZEIT_DATUM_ANZAHL)) %>%
  group_by(Monat) %>%
  summarise(Anzahl = n(), .groups = "drop")

# Halbiere die Anzahl der Fälle für Januar bis Oktober, da die ANzahl aus zwei Jahr zustande kommt
monat_anzahl <- monat_anzahl %>%
  mutate(Anzahl = case_when(
    Monat %in% c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct") ~ 
      ifelse(Monat == "Oct", Anzahl / (1 + 18 / 31), Anzahl / 2),
    TRUE ~ Anzahl
  ))

# Plot nur für Monate
ggplot(monat_anzahl, aes(x = Monat, y = Anzahl, fill = Monat)) +
  geom_bar(stat = "identity") +
  labs(
    title = "Durchschnitteliche Anzahl an Fällen von Fahrraddiebstählen je Monat",
    x = "Monat",
    y = "Anzahl der Fälle",
    fill = "Monat"
  ) +
  theme_minimal()
```
